# Repository Guidelines

## Project Structure & Module Organization

- `ci/` contains the main build pipelines (`ci/ci-build.sh`, `ci/proton-ge10/*`, `ci/protonwine10/*`, `ci/winlator/*`).
- `ci/lib/` holds shared shell helpers for toolchains, runtime assembly, validation, and packaging.
- `.github/workflows/` defines GitHub Actions entrypoints for Wine/Proton/Winlator builds and releases.
- `docs/` stores build reviews and reflective analysis reports generated by Winlator CI scripts.
- `tools/` contains auxiliary utilities; `work/` and `out/` are generated during local/CI runs and should be treated as disposable artifacts.

## Build, Test, and Development Commands

- `bash build.sh` - default local entrypoint (delegates to `ci/ci-build.sh`) for Wine ARM64EC WCP build.
- `bash ci/proton-ge10/ci-build-proton-ge10-wcp.sh` - builds Proton GE10 ARM64EC `.wcp`.
- `bash ci/protonwine10/ci-build-protonwine10-wcp.sh` - builds ProtonWine10 GameNative ARM64EC `.wcp`.
- `bash ci/winlator/ci-build-winlator-ludashi.sh` - clones upstream Winlator Ludashi, applies Aero.so patches, and builds the `by.aero.so.benchmark` APK.
- `bash ci/proton10/smoke-check-wcp.sh <path-to.wcp>` - quick validation for Proton10 WCP packaging output (when touching Proton10 flow).

## Coding Style & Naming Conventions

- Shell scripts use Bash with `#!/usr/bin/env bash` and `set -euo pipefail`; keep this pattern in new scripts.
- Prefer small shell functions (`snake_case`) and uppercase env/config variables (e.g. `WCP_NAME`, `WCP_OUTPUT_DIR`).
- Keep patches in `ci/winlator/patches/` as ordered files like `0001-*.patch`, `0002-*.patch`; regenerate clean unified diffs instead of hand-editing hunk headers.
- Keep comments short and purpose-driven; avoid restating obvious shell operations.

## Testing Guidelines

- There is no central unit-test suite in this repo; validation is mainly build + packaging checks.
- Run the narrowest relevant pipeline script locally before opening a PR (for example, Aero.so Winlator changes -> `ci/winlator/ci-build-winlator-ludashi.sh`).
- For packaging/runtime changes, verify generated artifacts in `out/` and checksums (`SHA256SUMS`) and review logs under `out/*/logs/`.

## Commit & Pull Request Guidelines

- Follow the existing commit style: scoped prefix + concise subject, e.g. `winlator: fix patch hunk headers`, `ci: rename workflow`.
- Keep commits focused by subsystem (`winlator`, `ci`, `wine`, `protonwine10`, `proton10`) to simplify bisecting CI failures.
- PRs should include: what pipeline was changed, which script/workflow was run, artifact/log evidence, and screenshots only for Winlator UI patch changes.

## Security & Configuration Tips

- Do not commit tokens, release credentials, or local device addresses; pass secrets through environment variables or GitHub Actions secrets.
- Prefer environment overrides (for refs/URLs/tags) over hardcoding values so CI and local runs stay reproducible.
