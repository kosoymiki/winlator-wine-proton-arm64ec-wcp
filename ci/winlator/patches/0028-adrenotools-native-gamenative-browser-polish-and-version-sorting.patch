From 69dcd08065eda1e2597e50372ec92b557a075ac5 Mon Sep 17 00:00:00 2001
From: Codex <codex@local>
Date: Tue, 24 Feb 2026 19:49:28 +0300
Subject: [PATCH] adrenotools: native gamenative browser and version sorting

---
 .../winlator/cmod/AdrenotoolsFragment.java    | 598 +++++++++++++++---
 .../main/res/layout/adrenotools_fragment.xml  |   6 +-
 app/src/main/res/values/strings.xml           |  13 +
 3 files changed, 534 insertions(+), 83 deletions(-)

diff --git a/app/src/main/java/com/winlator/cmod/AdrenotoolsFragment.java b/app/src/main/java/com/winlator/cmod/AdrenotoolsFragment.java
index eb54a6b..2cb94f3 100644
--- a/app/src/main/java/com/winlator/cmod/AdrenotoolsFragment.java
+++ b/app/src/main/java/com/winlator/cmod/AdrenotoolsFragment.java
@@ -3,13 +3,20 @@ package com.winlator.cmod;
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.ActivityNotFoundException;
+import android.content.Context;
 import android.content.Intent;
+import android.graphics.Typeface;
 import android.net.Uri;
 import android.os.Bundle;
+import android.text.SpannableStringBuilder;
+import android.text.Spanned;
+import android.text.TextUtils;
 import android.text.format.DateFormat;
+import android.text.style.StyleSpan;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
+import android.widget.BaseAdapter;
 import android.widget.ImageButton;
 import android.widget.TextView;
 
@@ -37,16 +44,29 @@ import java.io.InputStream;
 import java.io.OutputStream;
 import java.net.URL;
 import java.net.URLConnection;
+import java.net.URLDecoder;
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.HashSet;
 import java.util.Date;
 import java.util.Locale;
+import java.util.regex.Matcher;
+import java.util.regex.Pattern;
 
 public class AdrenotoolsFragment extends Fragment {
     private static final String GITHUB_DRIVER_RELEASES_API_TEMPLATE =
             "https://api.github.com/repos/%s/%s/releases?per_page=40";
     private static final long GITHUB_DRIVER_RELEASES_CACHE_TTL_MS = 15L * 60L * 1000L;
+    private static final long GAMENATIVE_DRIVER_LIST_CACHE_TTL_MS = 10L * 60L * 1000L;
+    private static final String GAMENATIVE_DRIVERS_URL = "https://gamenative.app/drivers/";
+    private static final Pattern GAMENATIVE_DRIVER_CARD_PATTERN = Pattern.compile(
+            "<h3[^>]*>([^<]+)</h3>.*?<a[^>]+href=\"(https://downloads\\.gamenative\\.app/[^\"]+?\\.zip)\"",
+            Pattern.CASE_INSENSITIVE | Pattern.DOTALL);
+    private static final Pattern TURNIP_VERSION_PATTERN = Pattern.compile(
+            "(?i)(?:turnip[_-]?v?|\\bv)(\\d+)\\.(\\d+)\\.(\\d+)");
+    private static final Pattern TURNIP_REV_PATTERN = Pattern.compile("(?i)[_-]r(\\d+)");
+    private static final Pattern TURNIP_BUILD_PATTERN = Pattern.compile("(?i)[_-]b(\\d+)|[_-]a(\\d+)");
+    private static final Pattern QUALCOMM_VERSION_PATTERN = Pattern.compile("(?i)(\\d{3})\\.(\\d+)");
 
     private AdrenotoolsManager adrenotoolsManager;
     private RecyclerView recyclerView;
@@ -116,29 +136,33 @@ public class AdrenotoolsFragment extends Fragment {
 
     private ArrayList<DriverSourceAuthor> buildDriverSourceAuthors() {
         ArrayList<DriverSourceAuthor> authors = new ArrayList<>();
-        authors.add(DriverSourceAuthor.github("StevenMXZ", "Mesa Turnip (GitHub Releases)",
+        authors.add(DriverSourceAuthor.github("StevenMXZ", "StevenMXZ • Turnip",
                 "StevenMXZ", "freedreno_turnip-CI",
                 DriverFamily.turnip()));
-        authors.add(DriverSourceAuthor.github("K11MCH1", "Qualcomm + Mesa Turnip (GitHub Releases)",
+        authors.add(DriverSourceAuthor.github("K11MCH1", "K11MCH1 • Qualcomm + Turnip",
                 "K11MCH1", "AdrenoToolsDrivers",
                 DriverFamily.qualcomm(), DriverFamily.turnip()));
-        authors.add(DriverSourceAuthor.external("GameNative", "Qualcomm + Mesa Turnip (Website)",
-                "https://gamenative.app/drivers/",
+        authors.add(DriverSourceAuthor.gameNative("GameNative", "GameNative • Qualcomm + Turnip",
+                GAMENATIVE_DRIVERS_URL,
                 DriverFamily.qualcomm(), DriverFamily.turnip()));
-        authors.add(DriverSourceAuthor.github("zoerakk", "Qualcomm ELITE (GitHub Releases)",
+        authors.add(DriverSourceAuthor.github("zoerakk", "zoerakk • Qualcomm ELITE",
                 "zoerakk", "qualcomm-adreno-driver",
                 DriverFamily.qualcomm()));
-        authors.add(DriverSourceAuthor.github("whitebelyash", "Mesa Turnip (GitHub Releases)",
+        authors.add(DriverSourceAuthor.github("whitebelyash", "whitebelyash • Turnip",
                 "whitebelyash", "freedreno_turnip-CI",
                 DriverFamily.turnip()));
-        authors.add(DriverSourceAuthor.github("Weab-chan", "Mesa Turnip (GitHub Releases)",
+        authors.add(DriverSourceAuthor.github("Weab-chan", "Weab-chan • Turnip",
                 "Weab-chan", "freedreno_turnip-CI",
                 DriverFamily.turnip()));
-        authors.add(DriverSourceAuthor.github("MrPurple666", "Mesa Turnip (GitHub Releases)",
+        authors.add(DriverSourceAuthor.github("MrPurple666", "MrPurple666 • Turnip",
                 "MrPurple666", "purple-turnip",
                 DriverFamily.turnip()));
-        authors.add(DriverSourceAuthor.github("XForYouX", "Mesa Turnip (GitHub Releases)",
-                "XForYouX", "Turnip_Driver",
+        authors.add(DriverSourceAuthor.githubWithFallbacks("XForYouX", "XForYouX • Turnip",
+                new String[][]{
+                        {"XForYouX", "Turnip_Driver"},
+                        {"XForYouX", "Turnip-Driver"},
+                        {"XForYouX", "freedreno_turnip-CI"}
+                },
                 DriverFamily.turnip()));
         return authors;
     }
@@ -151,28 +175,24 @@ public class AdrenotoolsFragment extends Fragment {
         new AlertDialog.Builder(getContext())
                 .setTitle(getString(R.string.driver_browser_choose_family_for, author.name))
                 .setItems(labels, (dialog, which) -> openDriverVersionBrowser(author, author.families.get(which), forceRefresh))
+                .setPositiveButton(R.string.back, (dialog, which) -> openDriverBrowser(forceRefresh))
                 .setNegativeButton(android.R.string.cancel, null)
                 .show();
     }
 
     private void openDriverVersionBrowser(DriverSourceAuthor author, DriverFamily family, boolean forceRefresh) {
-        if (author.externalUrl != null && (author.repoOwner == null || author.repoName == null)) {
-            openExternalDriverSource(author, family);
-            return;
-        }
-
         if (!isAdded() || getActivity() == null) return;
         DownloadProgressDialog progressDialog = new DownloadProgressDialog(getActivity());
         progressDialog.show(R.string.loading_driver_versions);
 
         new Thread(() -> {
             try {
-                ArrayList<RemoteDriverAssetItem> items = loadGithubDriverAssetItems(author, family, forceRefresh);
+                ArrayList<RemoteDriverAssetItem> items = loadDriverAssetItems(author, family, forceRefresh);
                 if (!isAdded() || getActivity() == null) return;
                 getActivity().runOnUiThread(() -> {
                     progressDialog.close();
                     if (items.isEmpty()) {
-                        AppUtils.showToast(getContext(), R.string.unable_to_fetch_driver_versions);
+                        showSourceUnavailableDialog(author, family, forceRefresh);
                         return;
                     }
                     showDriverVersionPicker(author, family, items, forceRefresh);
@@ -181,7 +201,7 @@ public class AdrenotoolsFragment extends Fragment {
                 if (!isAdded() || getActivity() == null) return;
                 getActivity().runOnUiThread(() -> {
                     progressDialog.close();
-                    AppUtils.showToast(getContext(), R.string.unable_to_fetch_driver_versions);
+                    showSourceUnavailableDialog(author, family, forceRefresh);
                 });
             }
         }).start();
@@ -190,40 +210,140 @@ public class AdrenotoolsFragment extends Fragment {
     private void showDriverVersionPicker(DriverSourceAuthor author, DriverFamily family,
                                          ArrayList<RemoteDriverAssetItem> items, boolean forceRefresh) {
         if (!isAdded() || getContext() == null) return;
-
-        String[] labels = new String[items.size()];
-        for (int i = 0; i < items.size(); i++) labels[i] = items.get(i).label;
-
         AlertDialog.Builder builder = new AlertDialog.Builder(getContext())
                 .setTitle(getString(R.string.driver_browser_choose_version_for, author.name, family.shortLabel))
-                .setItems(labels, (dialog, which) -> downloadAndInstall(items.get(which)))
+                .setAdapter(new DriverVersionDialogAdapter(getContext(), items),
+                        (dialog, which) -> showDriverVersionDetailsDialog(author, family, items, items.get(which), forceRefresh))
+                .setPositiveButton(R.string.back, (dialog, which) -> openDriverFamilyPicker(author, forceRefresh))
                 .setNegativeButton(android.R.string.cancel, null)
                 .setNeutralButton(R.string.refresh, (dialog, which) -> openDriverVersionBrowser(author, family, true));
 
-        if (author.externalUrl != null && !author.externalUrl.isEmpty()) {
-            builder.setMessage(getString(R.string.driver_browser_source_hint, author.externalUrl));
-        }
+        builder.setMessage(getString(R.string.driver_browser_source_hint, author.getPrimarySourceLabel()));
         builder.show();
     }
 
+    private void showDriverVersionDetailsDialog(DriverSourceAuthor author, DriverFamily family,
+                                                ArrayList<RemoteDriverAssetItem> items,
+                                                RemoteDriverAssetItem item,
+                                                boolean forceRefresh) {
+        if (!isAdded() || getContext() == null || item == null) return;
+        new AlertDialog.Builder(getContext())
+                .setTitle(item.displayTitle)
+                .setMessage(buildDriverReleaseDetailsText(item))
+                .setPositiveButton(R.string.driver_browser_download, (dialog, which) -> downloadAndInstall(item))
+                .setNeutralButton(R.string.back, (dialog, which) -> showDriverVersionPicker(author, family, items, forceRefresh))
+                .setNegativeButton(android.R.string.cancel, null)
+                .show();
+    }
+
+    private ArrayList<RemoteDriverAssetItem> loadDriverAssetItems(DriverSourceAuthor author, DriverFamily family,
+                                                                  boolean forceRefresh) throws Exception {
+        ArrayList<RemoteDriverAssetItem> items;
+        if (DriverSourceAuthor.SOURCE_GAMENATIVE.equals(author.sourceKind)) {
+            items = loadGameNativeDriverAssetItems(author, family, forceRefresh);
+        } else {
+            items = loadGithubDriverAssetItems(author, family, forceRefresh);
+        }
+        sortAndDecorateDriverItems(items, family);
+        return items;
+    }
+
+    private ArrayList<RemoteDriverAssetItem> loadGameNativeDriverAssetItems(DriverSourceAuthor author, DriverFamily family,
+                                                                            boolean forceRefresh) throws Exception {
+        String html = downloadCachedString("gamenative_drivers.html", author.externalUrl, forceRefresh, GAMENATIVE_DRIVER_LIST_CACHE_TTL_MS);
+        if (html == null || html.trim().isEmpty()) throw new IllegalStateException("empty gamenative html");
+
+        ArrayList<RemoteDriverAssetItem> items = new ArrayList<>();
+        HashSet<String> seen = new HashSet<>();
+        Matcher matcher = GAMENATIVE_DRIVER_CARD_PATTERN.matcher(html);
+        while (matcher.find()) {
+            String rawTitle = htmlUnescape(matcher.group(1));
+            String url = htmlUnescape(matcher.group(2));
+            if (TextUtils.isEmpty(rawTitle) || TextUtils.isEmpty(url)) continue;
+            if (!seen.add(url)) continue;
+            String assetName = extractUrlBasename(url);
+            if (!isAdrenoDriverAssetCandidate(assetName, rawTitle, rawTitle)) continue;
+            if (!family.matches(assetName, rawTitle, rawTitle)) continue;
+
+            RemoteDriverAssetItem item = new RemoteDriverAssetItem();
+            item.sourceKind = "gamenative";
+            item.authorName = author.name;
+            item.familyId = family.id;
+            item.familyLabel = family.shortLabel;
+            item.releaseName = rawTitle;
+            item.tagName = "";
+            item.assetName = assetName;
+            item.downloadUrl = url;
+            item.publishedAt = "";
+            item.prerelease = false;
+            item.sourcePageUrl = author.externalUrl;
+            item.sourceLabel = "GameNative";
+            item.releaseNotesSnippet = getString(R.string.driver_browser_gamenative_release_note);
+            items.add(item);
+        }
+        return items;
+    }
+
     private ArrayList<RemoteDriverAssetItem> loadGithubDriverAssetItems(DriverSourceAuthor author, DriverFamily family,
                                                                         boolean forceRefresh) throws Exception {
-        String cacheName = String.format(Locale.ROOT, "driver_releases_%s_%s.json",
-                author.repoOwner.toLowerCase(Locale.ROOT), author.repoName.toLowerCase(Locale.ROOT));
-        File cacheFile = new File(requireContext().getCacheDir(), cacheName);
-        String json = null;
-        if (!forceRefresh && cacheFile.isFile()) {
-            long age = System.currentTimeMillis() - cacheFile.lastModified();
-            if (age >= 0 && age <= GITHUB_DRIVER_RELEASES_CACHE_TTL_MS) {
-                json = FileUtils.readString(cacheFile);
+        ArrayList<RemoteDriverAssetItem> items = new ArrayList<>();
+        Exception lastError = null;
+        for (GithubRepoRef repo : author.getGithubRepos()) {
+            try {
+                ArrayList<RemoteDriverAssetItem> repoItems = loadGithubDriverAssetItemsFromRepo(author, family, repo, forceRefresh);
+                if (!repoItems.isEmpty()) return repoItems;
+            } catch (Exception e) {
+                lastError = e;
             }
         }
-        if (json == null || json.trim().isEmpty()) {
-            String api = String.format(Locale.ROOT, GITHUB_DRIVER_RELEASES_API_TEMPLATE, author.repoOwner, author.repoName);
-            json = Downloader.downloadString(api);
-            if (json == null || json.trim().isEmpty()) throw new IllegalStateException("empty github releases response");
-            FileUtils.writeString(cacheFile, json);
+        if (items.isEmpty() && !TextUtils.isEmpty(author.repoOwner)) {
+            try {
+                ArrayList<GithubRepoRef> discovered = discoverGithubReposForAuthor(author, family, forceRefresh);
+                for (GithubRepoRef repo : discovered) {
+                    ArrayList<RemoteDriverAssetItem> repoItems = loadGithubDriverAssetItemsFromRepo(author, family, repo, forceRefresh);
+                    if (!repoItems.isEmpty()) return repoItems;
+                }
+            } catch (Exception e) {
+                lastError = e;
+            }
         }
+        if (!items.isEmpty()) return items;
+        if (lastError != null) throw lastError;
+        return items;
+    }
+
+    private ArrayList<GithubRepoRef> discoverGithubReposForAuthor(DriverSourceAuthor author, DriverFamily family,
+                                                                  boolean forceRefresh) throws Exception {
+        ArrayList<GithubRepoRef> matches = new ArrayList<>();
+        String cacheName = String.format(Locale.ROOT, "driver_user_repos_%s.json",
+                author.repoOwner.toLowerCase(Locale.ROOT));
+        String api = String.format(Locale.ROOT, "https://api.github.com/users/%s/repos?per_page=100", author.repoOwner);
+        String json = downloadCachedString(cacheName, api, forceRefresh, GITHUB_DRIVER_RELEASES_CACHE_TTL_MS);
+        if (TextUtils.isEmpty(json)) return matches;
+        JSONArray repos = new JSONArray(json);
+        for (int i = 0; i < repos.length(); i++) {
+            JSONObject repo = repos.optJSONObject(i);
+            if (repo == null) continue;
+            String name = repo.optString("name", "");
+            if (TextUtils.isEmpty(name)) continue;
+            String probe = name.toLowerCase(Locale.ROOT);
+            if (family.isTurnip()) {
+                if (!(probe.contains("turnip") || probe.contains("freedreno") || probe.contains("purple"))) continue;
+            } else {
+                if (!(probe.contains("qualcomm") || probe.contains("adreno") || probe.contains("driver"))) continue;
+            }
+            matches.add(new GithubRepoRef(author.repoOwner, name));
+        }
+        return matches;
+    }
+
+    private ArrayList<RemoteDriverAssetItem> loadGithubDriverAssetItemsFromRepo(DriverSourceAuthor author, DriverFamily family,
+                                                                                GithubRepoRef repo, boolean forceRefresh) throws Exception {
+        String cacheName = String.format(Locale.ROOT, "driver_releases_%s_%s.json",
+                repo.owner.toLowerCase(Locale.ROOT), repo.name.toLowerCase(Locale.ROOT));
+        String api = String.format(Locale.ROOT, GITHUB_DRIVER_RELEASES_API_TEMPLATE, repo.owner, repo.name);
+        String json = downloadCachedString(cacheName, api, forceRefresh, GITHUB_DRIVER_RELEASES_CACHE_TTL_MS);
+        if (json == null || json.trim().isEmpty()) throw new IllegalStateException("empty github releases response");
 
         JSONArray releases = new JSONArray(json);
         ArrayList<RemoteDriverAssetItem> items = new ArrayList<>();
@@ -235,6 +355,8 @@ public class AdrenotoolsFragment extends Fragment {
             String tagName = release.optString("tag_name", "");
             String publishedAt = release.optString("published_at", "");
             boolean prerelease = release.optBoolean("prerelease", false);
+            String htmlUrl = release.optString("html_url", "");
+            String body = release.optString("body", "");
             JSONArray assets = release.optJSONArray("assets");
             if (assets == null) continue;
 
@@ -250,34 +372,23 @@ public class AdrenotoolsFragment extends Fragment {
                 if (!seen.add(url)) continue;
 
                 RemoteDriverAssetItem item = new RemoteDriverAssetItem();
+                item.sourceKind = "github";
                 item.authorName = author.name;
                 item.familyId = family.id;
+                item.familyLabel = family.shortLabel;
                 item.releaseName = releaseName;
                 item.tagName = tagName;
                 item.assetName = assetName;
                 item.downloadUrl = url;
                 item.publishedAt = publishedAt;
                 item.prerelease = prerelease;
-                item.label = buildGenericDriverLabel(item, i == 0);
+                item.sourcePageUrl = !TextUtils.isEmpty(htmlUrl) ? htmlUrl
+                        : String.format(Locale.ROOT, "https://github.com/%s/%s/releases", repo.owner, repo.name);
+                item.sourceLabel = repo.owner + "/" + repo.name;
+                item.releaseNotesSnippet = buildReleaseNotesSnippet(body);
                 items.add(item);
             }
         }
-
-        Collections.sort(items, (a, b) -> {
-            long ta = parseIsoDateMillis(a.publishedAt);
-            long tb = parseIsoDateMillis(b.publishedAt);
-            if (ta != tb) return Long.compare(tb, ta); // newest first
-            if (a.prerelease != b.prerelease) return a.prerelease ? 1 : -1; // stable first
-            int releaseCmp = safeString(b.releaseName).compareToIgnoreCase(safeString(a.releaseName));
-            if (releaseCmp != 0) return releaseCmp;
-            return safeString(a.assetName).compareToIgnoreCase(safeString(b.assetName));
-        });
-        if (!items.isEmpty()) {
-            // Rebuild labels after sort so "Latest" tag reflects the top item shown to the user.
-            for (int i = 0; i < items.size(); i++) {
-                items.get(i).label = buildGenericDriverLabel(items.get(i), i == 0);
-            }
-        }
         return items;
     }
 
@@ -294,33 +405,22 @@ public class AdrenotoolsFragment extends Fragment {
                 || combined.contains("mesa");
     }
 
-    private String buildGenericDriverLabel(RemoteDriverAssetItem item, boolean firstReleaseInList) {
-        String channel;
-        if (firstReleaseInList) channel = getString(R.string.turnip_channel_latest);
-        else if (item.prerelease) channel = getString(R.string.channel_beta);
-        else channel = getString(R.string.channel_stable);
-
-        String date = item.publishedAt;
-        if (date != null && date.length() >= 10) date = date.substring(0, 10);
-        else date = DateFormat.format("yyyy-MM-dd", new Date()).toString();
-
-        String releaseLabel = !item.releaseName.isEmpty() ? item.releaseName : item.tagName;
-        return releaseLabel + " • " + date + " • " + channel + "\n" + item.assetName;
-    }
-
-    private void openExternalDriverSource(DriverSourceAuthor author, DriverFamily family) {
-        if (!isAdded() || getContext() == null || author.externalUrl == null || author.externalUrl.isEmpty()) return;
+    private void showSourceUnavailableDialog(DriverSourceAuthor author, DriverFamily family, boolean forceRefresh) {
+        if (!isAdded() || getContext() == null) return;
         new AlertDialog.Builder(getContext())
-                .setTitle(getString(R.string.driver_browser_open_site_title, author.name))
-                .setMessage(getString(R.string.driver_browser_open_site_message, family.shortLabel))
-                .setPositiveButton(R.string.open_source_page, (dialog, which) -> {
-                    try {
-                        startActivity(new Intent(Intent.ACTION_VIEW, Uri.parse(author.externalUrl)));
-                    } catch (ActivityNotFoundException e) {
-                        AppUtils.showToast(getContext(), R.string.unable_to_fetch_driver_versions);
-                    }
-                })
+                .setTitle(getString(R.string.driver_browser_source_unavailable_title, author.name))
+                .setMessage(getString(R.string.driver_browser_source_unavailable_message, family.shortLabel, author.getPrimarySourceLabel()))
+                .setPositiveButton(R.string.back, (dialog, which) -> openDriverFamilyPicker(author, forceRefresh))
                 .setNegativeButton(android.R.string.cancel, null)
+                .setNeutralButton(TextUtils.isEmpty(author.externalUrl) ? null : getString(R.string.open_source_page),
+                        (dialog, which) -> {
+                            if (TextUtils.isEmpty(author.externalUrl)) return;
+                            try {
+                                startActivity(new Intent(Intent.ACTION_VIEW, Uri.parse(author.externalUrl)));
+                            } catch (ActivityNotFoundException e) {
+                                AppUtils.showToast(getContext(), R.string.unable_to_fetch_driver_versions);
+                            }
+                        })
                 .show();
     }
 
@@ -422,36 +522,299 @@ public class AdrenotoolsFragment extends Fragment {
         return value != null ? value : "";
     }
 
+    private String downloadCachedString(String cacheName, String url, boolean forceRefresh, long ttlMs) throws Exception {
+        if (!isAdded() || getContext() == null) throw new IllegalStateException("fragment not attached");
+        File cacheFile = new File(requireContext().getCacheDir(), cacheName);
+        String data = null;
+        if (!forceRefresh && cacheFile.isFile()) {
+            long age = System.currentTimeMillis() - cacheFile.lastModified();
+            if (age >= 0 && age <= ttlMs) {
+                data = FileUtils.readString(cacheFile);
+            }
+        }
+        if (TextUtils.isEmpty(data)) {
+            data = Downloader.downloadString(url);
+            if (!TextUtils.isEmpty(data)) {
+                FileUtils.writeString(cacheFile, data);
+            }
+        }
+        return data;
+    }
+
+    private String buildReleaseNotesSnippet(String body) {
+        if (TextUtils.isEmpty(body)) return "";
+        String normalized = body
+                .replaceAll("(?m)^#+\\s*", "")
+                .replaceAll("(?m)^[-*]\\s*", "• ")
+                .replaceAll("\\[(.*?)\\]\\((.*?)\\)", "$1")
+                .replace('\r', '\n')
+                .replaceAll("\\n{2,}", "\n")
+                .trim();
+        if (normalized.length() > 240) {
+            normalized = normalized.substring(0, 240).trim() + "…";
+        }
+        return normalized;
+    }
+
+    private void sortAndDecorateDriverItems(ArrayList<RemoteDriverAssetItem> items, DriverFamily family) {
+        if (items == null || items.isEmpty()) return;
+        for (RemoteDriverAssetItem item : items) {
+            item.sortDateMillis = parseIsoDateMillis(item.publishedAt);
+            item.semanticSortKey = computeSemanticSortKey(item, family);
+        }
+        Collections.sort(items, (a, b) -> {
+            if (a.semanticSortKey != Long.MIN_VALUE && b.semanticSortKey != Long.MIN_VALUE && a.semanticSortKey != b.semanticSortKey) {
+                return Long.compare(b.semanticSortKey, a.semanticSortKey);
+            }
+            if (a.sortDateMillis != b.sortDateMillis) {
+                return Long.compare(b.sortDateMillis, a.sortDateMillis);
+            }
+            if (a.prerelease != b.prerelease) {
+                return a.prerelease ? 1 : -1; // stable first when tie
+            }
+            int releaseCmp = safeString(b.releaseName).compareToIgnoreCase(safeString(a.releaseName));
+            if (releaseCmp != 0) return releaseCmp;
+            return safeString(a.assetName).compareToIgnoreCase(safeString(b.assetName));
+        });
+
+        for (int i = 0; i < items.size(); i++) {
+            RemoteDriverAssetItem item = items.get(i);
+            item.recommended = i == 0;
+            decorateDriverItem(item, family);
+        }
+    }
+
+    private long computeSemanticSortKey(RemoteDriverAssetItem item, DriverFamily family) {
+        String combined = (safeString(item.releaseName) + " " + safeString(item.tagName) + " " + safeString(item.assetName)).toLowerCase(Locale.ROOT);
+        if (family != null && family.isTurnip()) {
+            Matcher v = TURNIP_VERSION_PATTERN.matcher(combined);
+            if (v.find()) {
+                long major = parseLong(v.group(1), 0);
+                long minor = parseLong(v.group(2), 0);
+                long patch = parseLong(v.group(3), 0);
+                long rev = 0;
+                long build = 0;
+                Matcher r = TURNIP_REV_PATTERN.matcher(combined);
+                if (r.find()) rev = parseLong(r.group(1), 0);
+                Matcher b = TURNIP_BUILD_PATTERN.matcher(combined);
+                if (b.find()) build = parseLong(!TextUtils.isEmpty(b.group(1)) ? b.group(1) : b.group(2), 0);
+                return major * 1_000_000_000_000L
+                        + minor * 1_000_000_000L
+                        + patch * 1_000_000L
+                        + rev * 1_000L
+                        + build;
+            }
+        }
+        Matcher q = QUALCOMM_VERSION_PATTERN.matcher(combined);
+        if (q.find()) {
+            long major = parseLong(q.group(1), 0);
+            long minor = parseLong(q.group(2), 0);
+            return major * 1_000_000L + minor;
+        }
+        return Long.MIN_VALUE;
+    }
+
+    private long parseLong(String value, long fallback) {
+        if (TextUtils.isEmpty(value)) return fallback;
+        try {
+            return Long.parseLong(value);
+        } catch (NumberFormatException e) {
+            return fallback;
+        }
+    }
+
+    private void decorateDriverItem(RemoteDriverAssetItem item, DriverFamily family) {
+        String date = !TextUtils.isEmpty(item.publishedAt) && item.publishedAt.length() >= 10
+                ? item.publishedAt.substring(0, 10)
+                : "";
+        String releaseLabel = !TextUtils.isEmpty(item.releaseName) ? item.releaseName : item.tagName;
+        if (TextUtils.isEmpty(releaseLabel)) {
+            releaseLabel = extractTitleFromAsset(item.assetName, family);
+        }
+        item.displayTitle = releaseLabel;
+        item.displaySubtitle = item.authorName + " • " + safeString(item.familyLabel)
+                + (!TextUtils.isEmpty(date) ? " • " + date : "")
+                + (item.prerelease ? " • " + getString(R.string.channel_beta) : "");
+        item.displayMeta = safeString(item.assetName);
+        item.label = item.displayTitle + "\n" + item.displaySubtitle + "\n" + item.displayMeta;
+    }
+
+    private String extractTitleFromAsset(String assetName, DriverFamily family) {
+        if (TextUtils.isEmpty(assetName)) return getString(R.string.driver_browser_unknown_release);
+        String base = assetName;
+        if (base.toLowerCase(Locale.ROOT).endsWith(".zip")) {
+            base = base.substring(0, base.length() - 4);
+        }
+        base = base.replace('_', ' ').replace('-', ' ').trim();
+        if (family != null && family.isTurnip()) {
+            Matcher v = TURNIP_VERSION_PATTERN.matcher(base.toLowerCase(Locale.ROOT));
+            if (v.find()) {
+                StringBuilder label = new StringBuilder();
+                label.append("Turnip ")
+                        .append(v.group(1)).append('.').append(v.group(2)).append('.').append(v.group(3));
+                Matcher r = TURNIP_REV_PATTERN.matcher(base.toLowerCase(Locale.ROOT));
+                if (r.find()) label.append(" R").append(r.group(1));
+                Matcher b = TURNIP_BUILD_PATTERN.matcher(base.toLowerCase(Locale.ROOT));
+                if (b.find()) {
+                    String n = !TextUtils.isEmpty(b.group(1)) ? b.group(1) : b.group(2);
+                    label.append(" b").append(n);
+                }
+                return label.toString();
+            }
+        }
+        Matcher q = QUALCOMM_VERSION_PATTERN.matcher(base);
+        if (q.find()) {
+            return "Qualcomm " + q.group(1) + "." + q.group(2);
+        }
+        return base;
+    }
+
+    private CharSequence buildDriverReleaseDetailsText(RemoteDriverAssetItem item) {
+        SpannableStringBuilder sb = new SpannableStringBuilder();
+        appendDetailLine(sb, getString(R.string.package_source_repo_prefix), item.sourceLabel);
+        appendDetailLine(sb, getString(R.string.driver_browser_release_family), item.familyLabel);
+        appendDetailLine(sb, getString(R.string.driver_browser_release_asset), item.assetName);
+        if (!TextUtils.isEmpty(item.tagName)) appendDetailLine(sb, getString(R.string.driver_browser_release_tag), item.tagName);
+        if (!TextUtils.isEmpty(item.publishedAt)) appendDetailLine(sb, getString(R.string.driver_browser_release_date), item.publishedAt);
+        appendDetailLine(sb, getString(R.string.driver_browser_release_channel),
+                item.prerelease ? getString(R.string.channel_beta) : getString(R.string.channel_stable));
+        if (item.recommended) appendDetailLine(sb, getString(R.string.driver_browser_recommended), getString(R.string.driver_browser_recommended_hint));
+        if (!TextUtils.isEmpty(item.releaseNotesSnippet)) {
+            if (sb.length() > 0) sb.append("\n");
+            int start = sb.length();
+            sb.append(getString(R.string.driver_browser_release_notes)).append(":\n");
+            sb.setSpan(new StyleSpan(Typeface.BOLD), start, sb.length() - 1, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
+            int notesStart = sb.length();
+            sb.append(item.releaseNotesSnippet);
+            sb.setSpan(new StyleSpan(Typeface.ITALIC), notesStart, sb.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
+        }
+        if (!TextUtils.isEmpty(item.sourcePageUrl)) {
+            if (sb.length() > 0) sb.append("\n");
+            appendDetailLine(sb, getString(R.string.open_source_page), item.sourcePageUrl);
+        }
+        return sb;
+    }
+
+    private void appendDetailLine(SpannableStringBuilder sb, String key, String value) {
+        if (TextUtils.isEmpty(value)) return;
+        if (sb.length() > 0) sb.append('\n');
+        int keyStart = sb.length();
+        sb.append(key).append(": ");
+        sb.setSpan(new StyleSpan(Typeface.BOLD), keyStart, sb.length() - 2, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
+        sb.append(value);
+    }
+
+    private String htmlUnescape(String value) {
+        if (value == null) return "";
+        return value.replace("&amp;", "&")
+                .replace("&quot;", "\"")
+                .replace("&#39;", "'")
+                .replace("&lt;", "<")
+                .replace("&gt;", ">");
+    }
+
+    private String extractUrlBasename(String url) {
+        if (TextUtils.isEmpty(url)) return "";
+        int slash = url.lastIndexOf('/');
+        String base = slash >= 0 ? url.substring(slash + 1) : url;
+        int q = base.indexOf('?');
+        if (q >= 0) base = base.substring(0, q);
+        try {
+            return URLDecoder.decode(base, "UTF-8");
+        } catch (Exception e) {
+            return base;
+        }
+    }
+
     private interface ProgressCallback {
         void onProgress(int progress);
     }
 
     private static class DriverSourceAuthor {
+        static final String SOURCE_GITHUB = "github";
+        static final String SOURCE_GAMENATIVE = "gamenative";
+
         String name;
         String label;
+        String sourceKind = SOURCE_GITHUB;
         String repoOwner;
         String repoName;
         String externalUrl;
+        ArrayList<GithubRepoRef> githubRepos = new ArrayList<>();
         ArrayList<DriverFamily> families = new ArrayList<>();
 
         static DriverSourceAuthor github(String name, String label, String repoOwner, String repoName, DriverFamily... families) {
             DriverSourceAuthor author = new DriverSourceAuthor();
             author.name = name;
             author.label = label;
+            author.sourceKind = SOURCE_GITHUB;
             author.repoOwner = repoOwner;
             author.repoName = repoName;
+            author.githubRepos.add(new GithubRepoRef(repoOwner, repoName));
+            author.externalUrl = String.format(Locale.ROOT, "https://github.com/%s/%s/releases", repoOwner, repoName);
             if (families != null) Collections.addAll(author.families, families);
             return author;
         }
 
-        static DriverSourceAuthor external(String name, String label, String externalUrl, DriverFamily... families) {
+        static DriverSourceAuthor githubWithFallbacks(String name, String label, String[][] repos, DriverFamily... families) {
             DriverSourceAuthor author = new DriverSourceAuthor();
             author.name = name;
             author.label = label;
+            author.sourceKind = SOURCE_GITHUB;
+            if (repos != null) {
+                for (String[] repo : repos) {
+                    if (repo == null || repo.length < 2) continue;
+                    author.githubRepos.add(new GithubRepoRef(repo[0], repo[1]));
+                }
+            }
+            if (!author.githubRepos.isEmpty()) {
+                GithubRepoRef first = author.githubRepos.get(0);
+                author.repoOwner = first.owner;
+                author.repoName = first.name;
+                author.externalUrl = "https://github.com/" + first.owner;
+            }
+            if (families != null) Collections.addAll(author.families, families);
+            return author;
+        }
+
+        static DriverSourceAuthor gameNative(String name, String label, String externalUrl, DriverFamily... families) {
+            DriverSourceAuthor author = new DriverSourceAuthor();
+            author.name = name;
+            author.label = label;
+            author.sourceKind = SOURCE_GAMENATIVE;
             author.externalUrl = externalUrl;
             if (families != null) Collections.addAll(author.families, families);
             return author;
         }
+
+        ArrayList<GithubRepoRef> getGithubRepos() {
+            if (!githubRepos.isEmpty()) return githubRepos;
+            ArrayList<GithubRepoRef> single = new ArrayList<>();
+            if (!TextUtils.isEmpty(repoOwner) && !TextUtils.isEmpty(repoName)) {
+                single.add(new GithubRepoRef(repoOwner, repoName));
+            }
+            return single;
+        }
+
+        String getPrimarySourceLabel() {
+            if (SOURCE_GAMENATIVE.equals(sourceKind)) return "gamenative.app/drivers";
+            if (!TextUtils.isEmpty(repoOwner) && !TextUtils.isEmpty(repoName)) return repoOwner + "/" + repoName;
+            if (!githubRepos.isEmpty()) {
+                GithubRepoRef first = githubRepos.get(0);
+                return first.owner + "/" + first.name;
+            }
+            return !TextUtils.isEmpty(externalUrl) ? externalUrl : name;
+        }
+    }
+
+    private static class GithubRepoRef {
+        final String owner;
+        final String name;
+
+        GithubRepoRef(String owner, String name) {
+            this.owner = owner;
+            this.name = name;
+        }
     }
 
     private static class DriverFamily {
@@ -495,17 +858,88 @@ public class AdrenotoolsFragment extends Fragment {
     }
 
     private static class RemoteDriverAssetItem {
+        String sourceKind;
         String authorName;
         String familyId;
+        String familyLabel;
         String releaseName;
         String tagName;
         String assetName;
         String downloadUrl;
         String publishedAt;
         boolean prerelease;
+        String sourcePageUrl;
+        String sourceLabel;
+        String releaseNotesSnippet;
+        String displayTitle;
+        String displaySubtitle;
+        String displayMeta;
+        boolean recommended;
+        long sortDateMillis = Long.MIN_VALUE;
+        long semanticSortKey = Long.MIN_VALUE;
         String label;
     }
 
+    private class DriverVersionDialogAdapter extends BaseAdapter {
+        private final Context context;
+        private final ArrayList<RemoteDriverAssetItem> items;
+
+        DriverVersionDialogAdapter(Context context, ArrayList<RemoteDriverAssetItem> items) {
+            this.context = context;
+            this.items = items;
+        }
+
+        @Override
+        public int getCount() {
+            return items.size();
+        }
+
+        @Override
+        public Object getItem(int position) {
+            return items.get(position);
+        }
+
+        @Override
+        public long getItemId(int position) {
+            return position;
+        }
+
+        @Override
+        public View getView(int position, View convertView, ViewGroup parent) {
+            TextView tv = convertView instanceof TextView ? (TextView) convertView : new TextView(context);
+            int hp = (int) (context.getResources().getDisplayMetrics().density * 16);
+            int vp = (int) (context.getResources().getDisplayMetrics().density * 10);
+            tv.setPadding(hp, vp, hp, vp);
+            tv.setTextSize(14);
+            tv.setLineSpacing(0f, 1.15f);
+
+            RemoteDriverAssetItem item = items.get(position);
+            SpannableStringBuilder sb = new SpannableStringBuilder();
+            int tStart = sb.length();
+            sb.append(item.displayTitle != null ? item.displayTitle : item.label);
+            sb.setSpan(new StyleSpan(Typeface.BOLD), tStart, sb.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
+            if (item.recommended) {
+                sb.append("  ");
+                int rStart = sb.length();
+                sb.append(getString(R.string.driver_browser_recommended));
+                sb.setSpan(new StyleSpan(Typeface.BOLD_ITALIC), rStart, sb.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
+            }
+
+            if (!TextUtils.isEmpty(item.displaySubtitle)) {
+                sb.append('\n');
+                int sStart = sb.length();
+                sb.append(item.displaySubtitle);
+                sb.setSpan(new StyleSpan(Typeface.ITALIC), sStart, sb.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
+            }
+            if (!TextUtils.isEmpty(item.displayMeta)) {
+                sb.append('\n');
+                sb.append(item.displayMeta);
+            }
+            tv.setText(sb);
+            return tv;
+        }
+    }
+
     private class DriversAdapter extends RecyclerView.Adapter<DriversAdapter.ViewHolder> {
         private final ArrayList<String> driversList;
 
diff --git a/app/src/main/res/layout/adrenotools_fragment.xml b/app/src/main/res/layout/adrenotools_fragment.xml
index d9a8577..e6522f8 100644
--- a/app/src/main/res/layout/adrenotools_fragment.xml
+++ b/app/src/main/res/layout/adrenotools_fragment.xml
@@ -21,8 +21,10 @@
     <LinearLayout
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
+        android:baselineAligned="false"
         android:orientation="horizontal"
-        android:gravity="center_vertical">
+        android:gravity="center_vertical"
+        android:weightSum="2">
 
         <Button
             android:id="@+id/BTInstallDriver"
@@ -31,6 +33,7 @@
             android:layout_height="wrap_content"
             android:layout_weight="1"
             android:layout_marginEnd="6dp"
+            android:maxLines="2"
             android:text="@string/install_drivers" />
 
         <Button
@@ -40,6 +43,7 @@
             android:layout_height="wrap_content"
             android:layout_weight="1"
             android:layout_marginStart="6dp"
+            android:maxLines="2"
             android:text="@string/fetch_latest_turnip" />
 
     </LinearLayout>
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 63a06f9..9af742a 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -634,6 +634,20 @@ E.g. <b>META</b> for <i>META key</i>, \n
     <string name="open_source_page">Open source page</string>
     <string name="loading_driver_versions">Loading driver versions…</string>
     <string name="unable_to_fetch_driver_versions">Unable to fetch driver versions.</string>
+    <string name="driver_browser_source_unavailable_title">Driver source unavailable • %1$s</string>
+    <string name="driver_browser_source_unavailable_message">Could not load %1$s versions from %2$s. Check network access or try Refresh. You can also open the source page.</string>
+    <string name="driver_browser_download">Download</string>
+    <string name="driver_browser_gamenative_release_note">Parsed from GameNative driver page. Release notes are not provided by the source page.</string>
+    <string name="driver_browser_release_family">Driver type</string>
+    <string name="driver_browser_release_asset">Asset</string>
+    <string name="driver_browser_release_tag">Tag</string>
+    <string name="driver_browser_release_date">Published</string>
+    <string name="driver_browser_release_channel">Channel</string>
+    <string name="driver_browser_release_notes">Release notes</string>
+    <string name="driver_browser_unknown_release">Driver release</string>
+    <string name="driver_browser_recommended">Recommended</string>
+    <string name="driver_browser_recommended_hint">Latest version in this author/type list</string>
+    <string name="back">Back</string>
     <string name="driver_download_failed">Driver download failed.</string>
     <string name="driver_install_failed_or_exists">Driver install failed or version is already installed.</string>
     <string name="turnip_channel_latest">Latest</string>
-- 
2.43.0
