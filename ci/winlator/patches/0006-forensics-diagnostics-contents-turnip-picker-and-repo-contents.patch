From 5af3269220702f77f53dafb51cff616d2a0aa08a Mon Sep 17 00:00:00 2001
From: Codex <codex@local>
Date: Tue, 24 Feb 2026 03:01:26 +0300
Subject: [PATCH] winlator: forensics diagnostics repo contents and turnip
 picker (rebased contexts)

---
 .../winlator/cmod/DiagnosticsFragment.java    | 117 +++++++++
 .../java/com/winlator/cmod/MainActivity.java  |  15 +-
 .../cmod/container/ContainerDiscovery.java    | 104 ++++++++
 .../container/ContainerForensicSnapshot.java  |  39 +++
 .../cmod/container/ContainerManager.java      | 185 ++++++++++----
 .../cmod/container/ContainerNormalizer.java   | 174 +++++++++++++
 .../cmod/contentdialog/ContentInfoDialog.java |  28 ++-
 .../cmod/contents/ContentProfile.java         |  59 ++++-
 .../winlator/cmod/core/ForensicLogger.java    | 238 ++++++++++++++++++
 app/src/main/res/layout/content_list_item.xml |  57 +++--
 .../main/res/layout/diagnostics_fragment.xml  |  61 +++++
 app/src/main/res/menu/main_menu.xml           |  13 +-
 12 files changed, 987 insertions(+), 103 deletions(-)
 create mode 100644 app/src/main/java/com/winlator/cmod/DiagnosticsFragment.java
 create mode 100644 app/src/main/java/com/winlator/cmod/container/ContainerDiscovery.java
 create mode 100644 app/src/main/java/com/winlator/cmod/container/ContainerForensicSnapshot.java
 create mode 100644 app/src/main/java/com/winlator/cmod/container/ContainerNormalizer.java
 create mode 100644 app/src/main/java/com/winlator/cmod/core/ForensicLogger.java
 create mode 100644 app/src/main/res/layout/diagnostics_fragment.xml

diff --git a/app/src/main/java/com/winlator/cmod/DiagnosticsFragment.java b/app/src/main/java/com/winlator/cmod/DiagnosticsFragment.java
new file mode 100644
index 0000000..d973e2b
--- /dev/null
+++ b/app/src/main/java/com/winlator/cmod/DiagnosticsFragment.java
@@ -0,0 +1,117 @@
+package com.winlator.cmod;
+
+import android.content.Intent;
+import android.os.Bundle;
+import android.text.TextUtils;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.Button;
+import android.widget.EditText;
+import android.widget.TextView;
+import android.widget.Toast;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.appcompat.app.AppCompatActivity;
+import androidx.fragment.app.Fragment;
+
+import com.winlator.cmod.container.ContainerDiscovery;
+import com.winlator.cmod.container.ContainerManager;
+import com.winlator.cmod.core.ForensicLogger;
+
+public class DiagnosticsFragment extends Fragment {
+    private EditText etContainerId;
+    private TextView tvResult;
+
+    @Nullable
+    @Override
+    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
+        return inflater.inflate(R.layout.diagnostics_fragment, container, false);
+    }
+
+    @Override
+    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
+        super.onViewCreated(view, savedInstanceState);
+        etContainerId = view.findViewById(R.id.ETContainerId);
+        tvResult = view.findViewById(R.id.TVResult);
+
+        ((AppCompatActivity) requireActivity()).getSupportActionBar().setTitle(R.string.diagnostics);
+
+        Button btRunDirect = view.findViewById(R.id.BTRunDirectXServer);
+        Button btValidateParser = view.findViewById(R.id.BTValidateContainersParser);
+        Button btShowLastTrace = view.findViewById(R.id.BTShowLastForensicTrace);
+
+        btRunDirect.setOnClickListener(v -> runDirectXServerForensic());
+        btValidateParser.setOnClickListener(v -> validateContainersParser());
+        btShowLastTrace.setOnClickListener(v -> showLastForensicTrace());
+    }
+
+    private void runDirectXServerForensic() {
+        Integer containerId = parseContainerId();
+        if (containerId == null || containerId <= 0) {
+            toast(R.string.diagnostics_invalid_container_id);
+            return;
+        }
+
+        String traceId = ForensicLogger.newTraceId();
+        Intent intent = new Intent(requireContext(), XServerDisplayActivity.class);
+        intent.putExtra("container_id", containerId);
+        intent.putExtra("forensic_mode", true);
+        intent.putExtra("forensic_trace_id", traceId);
+        intent.putExtra("forensic_route_source", "direct_diag_ui");
+        intent.putExtra("forensic_skip_playtime", true);
+        startActivity(intent);
+
+        String message = getString(R.string.diagnostics_direct_launch_started, containerId, traceId);
+        tvResult.setText(message);
+        ForensicLogger.logEvent(requireContext(), "info", "ROUTE_DIAG_UI_START", traceId, "diagnostics_ui",
+                "Diagnostics UI requested direct XServer launch",
+                ForensicLogger.fields("container_id", containerId, "route", "direct_diag_ui"));
+    }
+
+    private void validateContainersParser() {
+        ContainerManager manager = new ContainerManager(requireContext());
+        ContainerDiscovery.LoadReport report = manager.getLastLoadReport();
+
+        StringBuilder sb = new StringBuilder();
+        sb.append(getString(R.string.diagnostics_parser_summary)).append('\n');
+        sb.append(report.toSummaryString());
+
+        if (!report.warnings.isEmpty()) {
+            sb.append("\n\n").append(getString(R.string.diagnostics_parser_warnings)).append('\n');
+            int limit = Math.min(report.warnings.size(), 8);
+            for (int i = 0; i < limit; i++) sb.append("- ").append(report.warnings.get(i)).append('\n');
+            if (report.warnings.size() > limit) {
+                sb.append("... +").append(report.warnings.size() - limit).append('\n');
+            }
+        }
+
+        tvResult.setText(sb.toString().trim());
+        ForensicLogger.logEvent(requireContext(), "info", "PARSER_DIAG_UI_VALIDATE", ForensicLogger.newTraceId(), "diagnostics_ui",
+                "Diagnostics UI validated container parser",
+                report.toJson());
+    }
+
+    private void showLastForensicTrace() {
+        String summary = ForensicLogger.describeLatestTrace(requireContext());
+        tvResult.setText(summary);
+        toast(R.string.diagnostics_trace_summary_loaded);
+    }
+
+    @Nullable
+    private Integer parseContainerId() {
+        String text = etContainerId != null ? etContainerId.getText().toString().trim() : "";
+        if (TextUtils.isEmpty(text)) return null;
+        try {
+            return Integer.parseInt(text);
+        }
+        catch (NumberFormatException e) {
+            return null;
+        }
+    }
+
+    private void toast(int stringId) {
+        Toast.makeText(requireContext(), stringId, Toast.LENGTH_SHORT).show();
+    }
+}
diff --git a/app/src/main/java/com/winlator/cmod/MainActivity.java b/app/src/main/java/com/winlator/cmod/MainActivity.java
index 020d9e8..45c00c0 100644
--- a/app/src/main/java/com/winlator/cmod/MainActivity.java
+++ b/app/src/main/java/com/winlator/cmod/MainActivity.java
@@ -251,12 +251,15 @@ public class MainActivity extends AppCompatActivity implements NavigationView.On
             case R.id.main_menu_contents:
                 show(new ContentsFragment(), false);  // Forward animation
                 break;
-            case R.id.main_menu_adrenotools_gpu_drivers:
-                show(new AdrenotoolsFragment(), false);
-                break;
-            case R.id.main_menu_settings:
-                show(new SettingsFragment(), false);  // Forward animation
-                break;
+            case R.id.main_menu_adrenotools_gpu_drivers:
+                show(new AdrenotoolsFragment(), false);
+                break;
+            case R.id.main_menu_diagnostics:
+                show(new DiagnosticsFragment(), false);
+                break;
+            case R.id.main_menu_settings:
+                show(new SettingsFragment(), false);  // Forward animation
+                break;
             case R.id.main_menu_about:
                 showAboutDialog();
                 break;
diff --git a/app/src/main/java/com/winlator/cmod/container/ContainerDiscovery.java b/app/src/main/java/com/winlator/cmod/container/ContainerDiscovery.java
new file mode 100644
index 0000000..3034d29
--- /dev/null
+++ b/app/src/main/java/com/winlator/cmod/container/ContainerDiscovery.java
@@ -0,0 +1,104 @@
+package com.winlator.cmod.container;
+
+import com.winlator.cmod.xenvironment.ImageFs;
+
+import org.json.JSONArray;
+import org.json.JSONException;
+import org.json.JSONObject;
+
+import java.util.ArrayList;
+import java.util.regex.Matcher;
+import java.util.regex.Pattern;
+
+public final class ContainerDiscovery {
+    private static final Pattern CANONICAL_CONTAINER_DIR =
+            Pattern.compile("^" + Pattern.quote(ImageFs.USER) + "-([1-9][0-9]*)$");
+
+    private ContainerDiscovery() {}
+
+    public static ParseResult parseContainerDirName(String dirName) {
+        ParseResult result = new ParseResult(dirName);
+        if (dirName == null || dirName.isEmpty()) {
+            result.reason = "empty_name";
+            return result;
+        }
+        if (!dirName.startsWith(ImageFs.USER + "-")) {
+            result.reason = "not_container_prefix";
+            return result;
+        }
+
+        Matcher matcher = CANONICAL_CONTAINER_DIR.matcher(dirName);
+        if (!matcher.matches()) {
+            String suffix = dirName.substring((ImageFs.USER + "-").length());
+            if (suffix.isEmpty()) result.reason = "empty_suffix";
+            else if (!suffix.matches("[0-9]+")) result.reason = "non_numeric_suffix";
+            else if (suffix.startsWith("0")) result.reason = "leading_zero";
+            else result.reason = "invalid_format";
+            return result;
+        }
+
+        try {
+            result.id = Integer.parseInt(matcher.group(1));
+            result.valid = true;
+            return result;
+        }
+        catch (NumberFormatException e) {
+            result.reason = "invalid_id";
+            return result;
+        }
+    }
+
+    public static final class ParseResult {
+        public final String dirName;
+        public boolean valid = false;
+        public int id = 0;
+        public String reason = "";
+
+        private ParseResult(String dirName) {
+            this.dirName = dirName;
+        }
+    }
+
+    public static final class LoadReport {
+        public int scannedDirectories;
+        public int validContainers;
+        public int ignoredDirectories;
+        public int missingConfig;
+        public int invalidConfig;
+        public int duplicateIds;
+        public int parseExceptions;
+        public final ArrayList<String> warnings = new ArrayList<>();
+
+        public void addWarning(String warning) {
+            warnings.add(warning);
+        }
+
+        public String toSummaryString() {
+            return "scanned=" + scannedDirectories
+                    + ", valid=" + validContainers
+                    + ", ignored=" + ignoredDirectories
+                    + ", missingConfig=" + missingConfig
+                    + ", invalidConfig=" + invalidConfig
+                    + ", duplicateIds=" + duplicateIds
+                    + ", parseExceptions=" + parseExceptions;
+        }
+
+        public JSONObject toJson() {
+            JSONObject obj = new JSONObject();
+            try {
+                obj.put("scanned_directories", scannedDirectories);
+                obj.put("valid_containers", validContainers);
+                obj.put("ignored_directories", ignoredDirectories);
+                obj.put("missing_config", missingConfig);
+                obj.put("invalid_config", invalidConfig);
+                obj.put("duplicate_ids", duplicateIds);
+                obj.put("parse_exceptions", parseExceptions);
+                JSONArray arr = new JSONArray();
+                for (String warning : warnings) arr.put(warning);
+                obj.put("warnings", arr);
+            }
+            catch (JSONException ignored) {}
+            return obj;
+        }
+    }
+}
diff --git a/app/src/main/java/com/winlator/cmod/container/ContainerForensicSnapshot.java b/app/src/main/java/com/winlator/cmod/container/ContainerForensicSnapshot.java
new file mode 100644
index 0000000..5395885
--- /dev/null
+++ b/app/src/main/java/com/winlator/cmod/container/ContainerForensicSnapshot.java
@@ -0,0 +1,39 @@
+package com.winlator.cmod.container;
+
+import com.winlator.cmod.core.ForensicLogger;
+
+import org.json.JSONException;
+import org.json.JSONObject;
+
+public final class ContainerForensicSnapshot {
+    private ContainerForensicSnapshot() {}
+
+    public static JSONObject create(Container container, Shortcut shortcut, ContainerNormalizer.NormalizationResult normalized, String routeSource) {
+        JSONObject obj = new JSONObject();
+        try {
+            obj.put("container_id", container != null ? container.id : 0);
+            obj.put("container_name", container != null ? container.getName() : "");
+            obj.put("container_dir", container != null && container.getRootDir() != null ? container.getRootDir().getAbsolutePath() : "");
+            obj.put("route", routeSource == null ? "" : routeSource);
+            obj.put("shortcut_path", shortcut != null && shortcut.file != null ? shortcut.file.getAbsolutePath() : "");
+
+            if (normalized != null) {
+                obj.put("wine_version", normalized.wineVersion);
+                obj.put("emulator", normalized.emulator);
+                obj.put("graphics_driver", normalized.graphicsDriver);
+                obj.put("audio_driver", normalized.audioDriver);
+                obj.put("dxwrapper", normalized.dxwrapper);
+                obj.put("dxwrapper_config_hash", ForensicLogger.sha256Hex(normalized.dxwrapperConfig));
+                obj.put("env_hash", ForensicLogger.sha256Hex(normalized.envVars));
+                obj.put("box64_preset", normalized.box64Preset);
+                obj.put("fexcore_preset", normalized.fexcorePreset);
+                obj.put("box64_version", normalized.box64Version);
+                obj.put("fexcore_version", normalized.fexcoreVersion);
+                obj.put("lc_all", normalized.lcAll);
+                obj.put("runtime_drift_fields", normalized.changedFieldsJson());
+            }
+        }
+        catch (JSONException ignored) {}
+        return obj;
+    }
+}
diff --git a/app/src/main/java/com/winlator/cmod/container/ContainerManager.java b/app/src/main/java/com/winlator/cmod/container/ContainerManager.java
index a634f8c..dd76baf 100644
--- a/app/src/main/java/com/winlator/cmod/container/ContainerManager.java
+++ b/app/src/main/java/com/winlator/cmod/container/ContainerManager.java
@@ -3,16 +3,17 @@ package com.winlator.cmod.container;
 import android.content.Context;
 import android.os.Handler;
 import android.os.Looper;
-import android.util.Log;
-
-import com.winlator.cmod.R;
-import com.winlator.cmod.contents.ContentsManager;
-import com.winlator.cmod.core.Callback;
-import com.winlator.cmod.core.FileUtils;
-import com.winlator.cmod.core.MSLink;
-import com.winlator.cmod.core.OnExtractFileListener;
-import com.winlator.cmod.core.TarCompressorUtils;
-import com.winlator.cmod.core.WineInfo;
+import android.util.Log;
+
+import com.winlator.cmod.R;
+import com.winlator.cmod.contents.ContentsManager;
+import com.winlator.cmod.core.Callback;
+import com.winlator.cmod.core.ForensicLogger;
+import com.winlator.cmod.core.FileUtils;
+import com.winlator.cmod.core.MSLink;
+import com.winlator.cmod.core.OnExtractFileListener;
+import com.winlator.cmod.core.TarCompressorUtils;
+import com.winlator.cmod.core.WineInfo;
 import com.winlator.cmod.xenvironment.ImageFs;
 
 import java.util.Arrays;
@@ -20,18 +21,21 @@ import java.util.Arrays;
 import org.json.JSONException;
 import org.json.JSONObject;
 
-import java.io.File;
-import java.util.ArrayList;
-import java.util.Comparator;
-import java.util.concurrent.Executors;
+import java.io.File;
+import java.util.ArrayList;
+import java.util.Comparator;
+import java.util.HashSet;
+import java.util.Set;
+import java.util.concurrent.Executors;
 
 public class ContainerManager {
     private final ArrayList<Container> containers = new ArrayList<>();
     private int maxContainerId = 0;
-    private final File homeDir;
-    private final Context context;
-
-    private boolean isInitialized = false; // New flag to track initialization
+    private final File homeDir;
+    private final Context context;
+    private ContainerDiscovery.LoadReport lastLoadReport = new ContainerDiscovery.LoadReport();
+
+    private boolean isInitialized = false; // New flag to track initialization
 
     public ContainerManager(Context context) {
         this.context = context;
@@ -46,38 +50,119 @@ public class ContainerManager {
         return isInitialized;
     }
 
-    public ArrayList<Container> getContainers() {
-        return containers;
-    }
-
-    // Load containers from the home directory
-    private void loadContainers() {
-        containers.clear();
-        maxContainerId = 0;
-
-        try {
-            File[] files = homeDir.listFiles();
-            if (files != null) {
-                for (File file : files) {
-                    if (file.isDirectory()) {
-                        if (file.getName().startsWith(ImageFs.USER + "-")) {
-                            Container container = new Container(
-                                    Integer.parseInt(file.getName().replace(ImageFs.USER + "-", "")), this
-                            );
-
-                            container.setRootDir(new File(homeDir, ImageFs.USER + "-" + container.id));
-                            JSONObject data = new JSONObject(FileUtils.readString(container.getConfigFile()));
-                            container.loadData(data);
-                            containers.add(container);
-                            maxContainerId = Math.max(maxContainerId, container.id);
-                        }
-                    }
-                }
-            }
-        } catch (JSONException | NullPointerException e) {
-            Log.e("ContainerManager", "Error loading containers", e);
-        }
-    }
+    public ArrayList<Container> getContainers() {
+        return containers;
+    }
+
+    public ContainerDiscovery.LoadReport getLastLoadReport() {
+        return lastLoadReport;
+    }
+
+    public ContainerDiscovery.LoadReport reloadContainers() {
+        loadContainers();
+        return lastLoadReport;
+    }
+
+    // Load containers from the home directory
+    private void loadContainers() {
+        containers.clear();
+        maxContainerId = 0;
+        lastLoadReport = new ContainerDiscovery.LoadReport();
+        Set<Integer> seenIds = new HashSet<>();
+
+        File[] files = homeDir.listFiles();
+        if (files == null) {
+            ForensicLogger.warn(context, "PARSER_HOME_LIST_NULL", null, "container_discovery",
+                    "homeDir.listFiles() returned null",
+                    ForensicLogger.fields("home_dir", homeDir.getAbsolutePath()));
+            return;
+        }
+
+        for (File file : files) {
+            if (!file.isDirectory()) continue;
+            lastLoadReport.scannedDirectories++;
+
+            ContainerDiscovery.ParseResult parsed = ContainerDiscovery.parseContainerDirName(file.getName());
+            if (!parsed.valid) {
+                if (file.getName().startsWith(ImageFs.USER + "-")) {
+                    lastLoadReport.ignoredDirectories++;
+                    String warning = "invalid_name:" + file.getName() + ":" + parsed.reason;
+                    lastLoadReport.addWarning(warning);
+                    ForensicLogger.warn(context, "PARSER_DIR_IGNORED", null, "container_discovery",
+                            "Ignoring invalid container directory name",
+                            ForensicLogger.fields(
+                                    "container_dir", file.getAbsolutePath(),
+                                    "dir_name", file.getName(),
+                                    "reason", parsed.reason));
+                }
+                continue;
+            }
+
+            if (!seenIds.add(parsed.id)) {
+                lastLoadReport.duplicateIds++;
+                String warning = "duplicate_container_id:" + parsed.id + ":" + file.getName();
+                lastLoadReport.addWarning(warning);
+                ForensicLogger.warn(context, "PARSER_DUPLICATE_CONTAINER_ID", null, "container_discovery",
+                        "Duplicate container id ignored",
+                        ForensicLogger.fields(
+                                "container_id", parsed.id,
+                                "container_dir", file.getAbsolutePath(),
+                                "dir_name", file.getName()));
+                continue;
+            }
+
+            try {
+                Container container = new Container(parsed.id, this);
+                container.setRootDir(file);
+
+                File configFile = container.getConfigFile();
+                if (!configFile.isFile()) {
+                    lastLoadReport.missingConfig++;
+                    String warning = "missing_config:" + file.getName();
+                    lastLoadReport.addWarning(warning);
+                    ForensicLogger.warn(context, "PARSER_CONTAINER_MISSING_CONFIG", null, "container_discovery",
+                            "Container directory missing .container file",
+                            ForensicLogger.fields(
+                                    "container_id", parsed.id,
+                                    "container_dir", file.getAbsolutePath(),
+                                    "config_path", configFile.getAbsolutePath()));
+                    continue;
+                }
+
+                String rawConfig = FileUtils.readString(configFile);
+                JSONObject data = new JSONObject(rawConfig);
+                container.loadData(data);
+                containers.add(container);
+                lastLoadReport.validContainers++;
+                maxContainerId = Math.max(maxContainerId, container.id);
+            }
+            catch (JSONException | NullPointerException e) {
+                lastLoadReport.invalidConfig++;
+                lastLoadReport.addWarning("config_json_error:" + file.getName());
+                Log.e("ContainerManager", "Error loading container config: " + file.getAbsolutePath(), e);
+                ForensicLogger.error(context, "PARSER_CONTAINER_CONFIG_ERROR", null, "container_discovery",
+                        "Container config could not be parsed", e,
+                        ForensicLogger.fields(
+                                "container_id", parsed.id,
+                                "container_dir", file.getAbsolutePath(),
+                                "config_path", new File(file, ".container").getAbsolutePath()));
+            }
+            catch (RuntimeException e) {
+                lastLoadReport.parseExceptions++;
+                lastLoadReport.addWarning("parse_exception:" + file.getName() + ":" + e.getClass().getSimpleName());
+                Log.e("ContainerManager", "Unexpected error loading container: " + file.getAbsolutePath(), e);
+                ForensicLogger.error(context, "PARSER_CONTAINER_RUNTIME_ERROR", null, "container_discovery",
+                        "Unexpected exception while loading container", e,
+                        ForensicLogger.fields(
+                                "container_id", parsed.id,
+                                "container_dir", file.getAbsolutePath()));
+            }
+        }
+
+        ForensicLogger.logEvent(context, "info", "PARSER_LOAD_SUMMARY", null, "container_discovery",
+                "Container discovery completed",
+                lastLoadReport.toJson());
+    }
 
 
     public Context getContext() {
diff --git a/app/src/main/java/com/winlator/cmod/container/ContainerNormalizer.java b/app/src/main/java/com/winlator/cmod/container/ContainerNormalizer.java
new file mode 100644
index 0000000..d9292d0
--- /dev/null
+++ b/app/src/main/java/com/winlator/cmod/container/ContainerNormalizer.java
@@ -0,0 +1,174 @@
+package com.winlator.cmod.container;
+
+import com.winlator.cmod.box64.Box64Preset;
+import com.winlator.cmod.core.EnvVars;
+import com.winlator.cmod.core.WineInfo;
+import com.winlator.cmod.fexcore.FEXCorePreset;
+
+import org.json.JSONArray;
+import org.json.JSONException;
+import org.json.JSONObject;
+
+import java.util.ArrayList;
+import java.util.Arrays;
+
+public final class ContainerNormalizer {
+    private ContainerNormalizer() {}
+
+    public static NormalizationResult normalizeForLaunch(Container container, Shortcut shortcut) {
+        NormalizationResult result = new NormalizationResult();
+        if (container == null) return result;
+
+        result.containerId = container.id;
+        result.rawWineVersion = safe(container.getWineVersion());
+        result.rawGraphicsDriver = safe(container.getGraphicsDriver());
+        result.rawAudioDriver = safe(container.getAudioDriver());
+        result.rawEmulator = safe(resolveShortcutOverride(shortcut, "emulator", container.getEmulator()));
+        result.rawDxwrapper = safe(container.getDXWrapper());
+        result.rawDxwrapperConfig = safe(container.getDXWrapperConfig());
+        result.rawEnvVars = safe(resolveShortcutAppendEnvVars(container, shortcut));
+        result.rawBox64Preset = safe(resolveShortcutOverride(shortcut, "box64Preset", container.getBox64Preset()));
+        result.rawFexcorePreset = safe(resolveShortcutOverride(shortcut, "fexcorePreset", container.getFEXCorePreset()));
+        result.rawBox64Version = safe(resolveShortcutOverride(shortcut, "box64Version", container.getBox64Version()));
+        result.rawFexcoreVersion = safe(container.getFEXCoreVersion());
+        result.rawLcAll = safe(container.getLC_ALL());
+
+        result.wineVersion = fallback(result.rawWineVersion, WineInfo.MAIN_WINE_VERSION.identifier());
+        result.graphicsDriver = fallback(result.rawGraphicsDriver, Container.DEFAULT_GRAPHICS_DRIVER);
+        result.audioDriver = fallback(result.rawAudioDriver, Container.DEFAULT_AUDIO_DRIVER);
+        result.emulator = fallback(result.rawEmulator, Container.DEFAULT_EMULATOR);
+        result.dxwrapper = fallback(result.rawDxwrapper, Container.DEFAULT_DXWRAPPER);
+        result.dxwrapperConfig = fallback(result.rawDxwrapperConfig, Container.DEFAULT_DXWRAPPERCONFIG);
+        result.envVars = normalizeEnvVarsString(result.rawEnvVars);
+        result.box64Preset = fallback(result.rawBox64Preset, Box64Preset.COMPATIBILITY);
+        result.fexcorePreset = fallback(result.rawFexcorePreset, FEXCorePreset.INTERMEDIATE);
+        result.box64Version = trimToEmpty(result.rawBox64Version);
+        result.fexcoreVersion = trimToEmpty(result.rawFexcoreVersion);
+        result.lcAll = trimToEmpty(result.rawLcAll);
+
+        result.noteChange("wineVersion", result.rawWineVersion, result.wineVersion);
+        result.noteChange("graphicsDriver", result.rawGraphicsDriver, result.graphicsDriver);
+        result.noteChange("audioDriver", result.rawAudioDriver, result.audioDriver);
+        result.noteChange("emulator", result.rawEmulator, result.emulator);
+        result.noteChange("dxwrapper", result.rawDxwrapper, result.dxwrapper);
+        result.noteChange("dxwrapperConfig", result.rawDxwrapperConfig, result.dxwrapperConfig);
+        result.noteChange("envVars", result.rawEnvVars, result.envVars);
+        result.noteChange("box64Preset", result.rawBox64Preset, result.box64Preset);
+        result.noteChange("fexcorePreset", result.rawFexcorePreset, result.fexcorePreset);
+        result.noteChange("box64Version", result.rawBox64Version, result.box64Version);
+        result.noteChange("fexcoreVersion", result.rawFexcoreVersion, result.fexcoreVersion);
+        result.noteChange("lc_all", result.rawLcAll, result.lcAll);
+
+        return result;
+    }
+
+    private static String resolveShortcutAppendEnvVars(Container container, Shortcut shortcut) {
+        String base = safe(container.getEnvVars());
+        if (shortcut == null) return base;
+        String extra = safe(shortcut.getExtra("envVars"));
+        if (extra.isEmpty()) return base;
+        return (base + " " + extra).trim();
+    }
+
+    private static String resolveShortcutOverride(Shortcut shortcut, String key, String fallback) {
+        if (shortcut == null) return fallback;
+        return shortcut.getExtra(key, fallback);
+    }
+
+    public static String normalizeEnvVarsString(String envVarsValue) {
+        String value = trimToEmpty(envVarsValue);
+        if (value.isEmpty()) return "";
+
+        EnvVars envVars = new EnvVars();
+        try {
+            envVars.putAll(value);
+        }
+        catch (Exception e) {
+            // Fallback to raw value if parsing fails; caller will still see drift as empty diff.
+            return value;
+        }
+
+        String[] arr = envVars.toStringArray();
+        Arrays.sort(arr);
+        return String.join(" ", arr).trim();
+    }
+
+    private static String fallback(String value, String fallback) {
+        String out = trimToEmpty(value);
+        return out.isEmpty() ? trimToEmpty(fallback) : out;
+    }
+
+    private static String safe(String value) {
+        return value == null ? "" : value;
+    }
+
+    private static String trimToEmpty(String value) {
+        return value == null ? "" : value.trim();
+    }
+
+    public static final class NormalizationResult {
+        public int containerId;
+        public String rawWineVersion = "";
+        public String rawGraphicsDriver = "";
+        public String rawAudioDriver = "";
+        public String rawEmulator = "";
+        public String rawDxwrapper = "";
+        public String rawDxwrapperConfig = "";
+        public String rawEnvVars = "";
+        public String rawBox64Preset = "";
+        public String rawFexcorePreset = "";
+        public String rawBox64Version = "";
+        public String rawFexcoreVersion = "";
+        public String rawLcAll = "";
+
+        public String wineVersion = "";
+        public String graphicsDriver = "";
+        public String audioDriver = "";
+        public String emulator = "";
+        public String dxwrapper = "";
+        public String dxwrapperConfig = "";
+        public String envVars = "";
+        public String box64Preset = "";
+        public String fexcorePreset = "";
+        public String box64Version = "";
+        public String fexcoreVersion = "";
+        public String lcAll = "";
+
+        private final ArrayList<String> changedFields = new ArrayList<>();
+
+        private void noteChange(String field, String raw, String normalized) {
+            if (!safe(raw).equals(safe(normalized))) changedFields.add(field);
+        }
+
+        public boolean hasDrift() {
+            return !changedFields.isEmpty();
+        }
+
+        public JSONArray changedFieldsJson() {
+            JSONArray arr = new JSONArray();
+            for (String name : changedFields) arr.put(name);
+            return arr;
+        }
+
+        public String changedFieldsSummary() {
+            return changedFields.isEmpty() ? "" : String.join(",", changedFields);
+        }
+
+        public JSONObject toJson() {
+            JSONObject obj = new JSONObject();
+            try {
+                obj.put("container_id", containerId);
+                obj.put("changed_fields", changedFieldsJson());
+                obj.put("wine_version", wineVersion);
+                obj.put("emulator", emulator);
+                obj.put("dxwrapper", dxwrapper);
+                obj.put("dxwrapper_config_hash", com.winlator.cmod.core.ForensicLogger.sha256Hex(dxwrapperConfig));
+                obj.put("env_hash", com.winlator.cmod.core.ForensicLogger.sha256Hex(envVars));
+                obj.put("box64_preset", box64Preset);
+                obj.put("fexcore_preset", fexcorePreset);
+            }
+            catch (JSONException ignored) {}
+            return obj;
+        }
+    }
+}
diff --git a/app/src/main/java/com/winlator/cmod/contentdialog/ContentInfoDialog.java b/app/src/main/java/com/winlator/cmod/contentdialog/ContentInfoDialog.java
index ea9be65..349c112 100644
--- a/app/src/main/java/com/winlator/cmod/contentdialog/ContentInfoDialog.java
+++ b/app/src/main/java/com/winlator/cmod/contentdialog/ContentInfoDialog.java
@@ -14,7 +14,8 @@ import androidx.recyclerview.widget.RecyclerView;
 import com.winlator.cmod.R;
 import com.winlator.cmod.contents.ContentProfile;
 
-import java.util.List;
+import java.util.Collections;
+import java.util.List;
 
 public class ContentInfoDialog extends ContentDialog {
     public ContentInfoDialog(Context context, ContentProfile profile) {
@@ -28,11 +29,26 @@ public class ContentInfoDialog extends ContentDialog {
         TextView tvDescription = findViewById(R.id.TVDesc);
         RecyclerView recyclerView = findViewById(R.id.recyclerView);
 
-        tvType.setText(profile.type.toString());
-        tvVersion.setText(profile.verName);
-        tvVersionCode.setText(String.valueOf(profile.verCode));
-        tvDescription.setText(profile.desc);
-        recyclerView.setAdapter(new ContentInfoFileAdapter(profile.fileList));
+        tvType.setText(profile.getDisplayCategory());
+        tvVersion.setText(profile.verName);
+        tvVersionCode.setText(String.valueOf(profile.verCode));
+        StringBuilder descBuilder = new StringBuilder();
+        if (profile.desc != null && !profile.desc.isEmpty()) descBuilder.append(profile.desc);
+        if (profile.channel != null && !profile.channel.isEmpty()) {
+            if (descBuilder.length() > 0) descBuilder.append("\n\n");
+            descBuilder.append("Channel: ").append(profile.getChannel());
+        }
+        if (profile.delivery != null && !profile.delivery.isEmpty()) {
+            descBuilder.append("\nDelivery: ").append(profile.getDelivery());
+        }
+        if (profile.sourceRepo != null && !profile.sourceRepo.isEmpty()) {
+            descBuilder.append("\nSource: ").append(profile.sourceRepo);
+        }
+        if (profile.releaseTag != null && !profile.releaseTag.isEmpty()) {
+            descBuilder.append("\nRelease tag: ").append(profile.releaseTag);
+        }
+        tvDescription.setText(descBuilder.toString());
+        recyclerView.setAdapter(new ContentInfoFileAdapter(profile.fileList == null ? Collections.emptyList() : profile.fileList));
         recyclerView.setLayoutManager(new LinearLayoutManager(recyclerView.getContext()));
         recyclerView.addItemDecoration(new DividerItemDecoration(recyclerView.getContext(), DividerItemDecoration.VERTICAL));
 
diff --git a/app/src/main/java/com/winlator/cmod/contents/ContentProfile.java b/app/src/main/java/com/winlator/cmod/contents/ContentProfile.java
index 65b9474..b55681e 100644
--- a/app/src/main/java/com/winlator/cmod/contents/ContentProfile.java
+++ b/app/src/main/java/com/winlator/cmod/contents/ContentProfile.java
@@ -4,7 +4,7 @@ import androidx.annotation.NonNull;
 
 import java.util.List;
 
-public class ContentProfile {
+public class ContentProfile {
     public static final String MARK_TYPE = "type";
     public static final String MARK_VERSION_NAME = "versionName";
     public static final String MARK_VERSION_CODE = "versionCode";
@@ -12,12 +12,22 @@ public class ContentProfile {
     public static final String MARK_FILE_LIST = "files";
     public static final String MARK_FILE_SOURCE = "source";
     public static final String MARK_FILE_TARGET = "target";
-    public static final String MARK_WINE = "wine";
-    public static final String MARK_WINE_BINPATH = "binPath";
-    public static final String MARK_WINE_LIBPATH = "libPath";
-    public static final String MARK_WINE_PREFIX_PACK = "prefixPack";
-
-    public enum ContentType {
+    public static final String MARK_WINE = "wine";
+    public static final String MARK_WINE_BINPATH = "binPath";
+    public static final String MARK_WINE_LIBPATH = "libPath";
+    public static final String MARK_WINE_PREFIX_PACK = "prefixPack";
+    public static final String MARK_CHANNEL = "channel";
+    public static final String MARK_DELIVERY = "delivery";
+    public static final String MARK_DISPLAY_CATEGORY = "displayCategory";
+    public static final String MARK_SOURCE_REPO = "sourceRepo";
+    public static final String MARK_RELEASE_TAG = "releaseTag";
+    public static final String CHANNEL_STABLE = "stable";
+    public static final String CHANNEL_BETA = "beta";
+    public static final String CHANNEL_NIGHTLY = "nightly";
+    public static final String DELIVERY_REMOTE = "remote";
+    public static final String DELIVERY_EMBEDDED = "embedded";
+
+    public enum ContentType {
         CONTENT_TYPE_WINE("Wine"),
         CONTENT_TYPE_DXVK("DXVK"),
         CONTENT_TYPE_VKD3D("VKD3D"),
@@ -57,6 +67,35 @@ public class ContentProfile {
     public List<ContentFile> fileList;
     public String wineLibPath;
     public String wineBinPath;
-    public String winePrefixPack;
-    public String remoteUrl;
-}
+    public String winePrefixPack;
+    public String remoteUrl;
+    public String channel = CHANNEL_STABLE;
+    public String delivery = "";
+    public String displayCategory = "";
+    public String sourceRepo = "";
+    public String releaseTag = "";
+
+    public String getChannel() {
+        if (channel == null || channel.trim().isEmpty()) return CHANNEL_STABLE;
+        return channel.trim().toLowerCase();
+    }
+
+    public String getDelivery() {
+        return delivery == null ? "" : delivery.trim().toLowerCase();
+    }
+
+    public String getDisplayCategory() {
+        if (displayCategory != null && !displayCategory.trim().isEmpty()) return displayCategory.trim();
+        if (type == ContentType.CONTENT_TYPE_WINE) return "Wine/Proton";
+        return type != null ? type.toString() : "";
+    }
+
+    public boolean isBetaLike() {
+        String ch = getChannel();
+        return CHANNEL_BETA.equals(ch) || CHANNEL_NIGHTLY.equals(ch);
+    }
+
+    public boolean isRemoteDownloadable() {
+        return remoteUrl != null && !remoteUrl.trim().isEmpty();
+    }
+}
diff --git a/app/src/main/java/com/winlator/cmod/core/ForensicLogger.java b/app/src/main/java/com/winlator/cmod/core/ForensicLogger.java
new file mode 100644
index 0000000..76a8f4e
--- /dev/null
+++ b/app/src/main/java/com/winlator/cmod/core/ForensicLogger.java
@@ -0,0 +1,238 @@
+package com.winlator.cmod.core;
+
+import android.content.Context;
+import android.text.format.DateFormat;
+import android.util.Log;
+
+import org.json.JSONArray;
+import org.json.JSONException;
+import org.json.JSONObject;
+
+import java.io.BufferedReader;
+import java.io.BufferedWriter;
+import java.io.File;
+import java.io.FileReader;
+import java.io.FileWriter;
+import java.io.IOException;
+import java.nio.charset.StandardCharsets;
+import java.security.MessageDigest;
+import java.security.NoSuchAlgorithmException;
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Date;
+import java.util.Locale;
+
+public final class ForensicLogger {
+    private static final String TAG = "ForensicLogger";
+    private static final Object FILE_LOCK = new Object();
+
+    private ForensicLogger() {}
+
+    public static String newTraceId() {
+        long now = System.currentTimeMillis();
+        int salt = (int) (Math.random() * 0xffff);
+        return String.format(Locale.US, "tr-%x-%04x", now, salt);
+    }
+
+    public static void info(Context context, String eventId, String traceId, String stage, String message) {
+        logEvent(context, "info", eventId, traceId, stage, message, null);
+    }
+
+    public static void warn(Context context, String eventId, String traceId, String stage, String message, JSONObject fields) {
+        logEvent(context, "warn", eventId, traceId, stage, message, fields);
+    }
+
+    public static void error(Context context, String eventId, String traceId, String stage, String message, Throwable error, JSONObject fields) {
+        JSONObject merged = new JSONObject();
+        if (fields != null) {
+            JSONArray names = fields.names();
+            if (names != null) {
+                for (int i = 0; i < names.length(); i++) {
+                    String key = names.optString(i, "");
+                    if (key.isEmpty()) continue;
+                    try {
+                        merged.put(key, fields.opt(key));
+                    }
+                    catch (JSONException ignored) {}
+                }
+            }
+        }
+        if (error != null) {
+            try {
+                merged.put("error_class", error.getClass().getName());
+                merged.put("error_detail", String.valueOf(error.getMessage()));
+            }
+            catch (JSONException ignored) {}
+        }
+        logEvent(context, "error", eventId, traceId, stage, message, merged);
+    }
+
+    public static void logEvent(Context context, String severity, String eventId, String traceId, String stage, String message, JSONObject fields) {
+        JSONObject obj = new JSONObject();
+        try {
+            obj.put("ts", DateFormat.format("yyyy-MM-dd'T'HH:mm:ss.SSSZ", new Date()).toString());
+            obj.put("event_id", sanitize(eventId));
+            obj.put("severity", sanitize(severity));
+            obj.put("trace_id", traceId == null ? JSONObject.NULL : traceId);
+            obj.put("stage", stage == null ? JSONObject.NULL : stage);
+            obj.put("message", message == null ? "" : message);
+
+            if (fields != null) {
+                JSONArray names = fields.names();
+                if (names != null) {
+                    for (int i = 0; i < names.length(); i++) {
+                        String key = names.optString(i, "");
+                        if (key.isEmpty()) continue;
+                        obj.put(key, fields.opt(key));
+                    }
+                }
+            }
+        }
+        catch (JSONException e) {
+            Log.e(TAG, "Failed to build forensic event", e);
+            return;
+        }
+
+        String line = obj.toString();
+        logcat(severity, line);
+        if (context == null) return;
+
+        synchronized (FILE_LOCK) {
+            File out = getCurrentLogFile(context);
+            try (BufferedWriter writer = new BufferedWriter(new FileWriter(out, true))) {
+                writer.write(line);
+                writer.newLine();
+            }
+            catch (IOException e) {
+                Log.e(TAG, "Failed writing forensic jsonl", e);
+            }
+        }
+    }
+
+    public static JSONObject fields(Object... keyValues) {
+        JSONObject obj = new JSONObject();
+        if (keyValues == null) return obj;
+        for (int i = 0; i + 1 < keyValues.length; i += 2) {
+            String key = String.valueOf(keyValues[i]);
+            Object value = keyValues[i + 1];
+            try {
+                obj.put(key, value == null ? JSONObject.NULL : value);
+            }
+            catch (JSONException ignored) {}
+        }
+        return obj;
+    }
+
+    public static String hashEnvVars(EnvVars envVars) {
+        if (envVars == null || envVars.isEmpty()) return "";
+        String[] values = envVars.toStringArray();
+        Arrays.sort(values);
+        return sha256Hex(String.join("\n", values));
+    }
+
+    public static String sha256Hex(String value) {
+        return sha256Hex(value != null ? value.getBytes(StandardCharsets.UTF_8) : new byte[0]);
+    }
+
+    public static String sha256Hex(byte[] value) {
+        try {
+            MessageDigest digest = MessageDigest.getInstance("SHA-256");
+            byte[] out = digest.digest(value);
+            StringBuilder sb = new StringBuilder(out.length * 2);
+            for (byte b : out) sb.append(String.format(Locale.US, "%02x", b));
+            return sb.toString();
+        }
+        catch (NoSuchAlgorithmException e) {
+            return "";
+        }
+    }
+
+    public static File getForensicsDir(Context context) {
+        File dir = new File(WinlatorLogUtils.getLogsDir(context), "forensics");
+        if (!dir.exists()) dir.mkdirs();
+        return dir;
+    }
+
+    public static File getCurrentLogFile(Context context) {
+        String fileName = "forensics_" + DateFormat.format("yyyy-MM-dd", new Date()) + ".jsonl";
+        return new File(getForensicsDir(context), fileName);
+    }
+
+    public static File getLatestLogFile(Context context) {
+        File dir = getForensicsDir(context);
+        File[] files = dir.listFiles((d, name) -> name.endsWith(".jsonl"));
+        if (files == null || files.length == 0) return null;
+        File latest = files[0];
+        for (File file : files) {
+            if (file.lastModified() > latest.lastModified()) latest = file;
+        }
+        return latest;
+    }
+
+    public static String describeLatestTrace(Context context) {
+        File file = getLatestLogFile(context);
+        if (file == null || !file.isFile()) return "No forensic trace file found.";
+
+        String lastLine = null;
+        ArrayList<String> lastLines = new ArrayList<>();
+        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
+            String line;
+            while ((line = reader.readLine()) != null) {
+                if (line.trim().isEmpty()) continue;
+                lastLine = line;
+                if (lastLines.size() == 5) lastLines.remove(0);
+                lastLines.add(line);
+            }
+        }
+        catch (IOException e) {
+            return "Failed reading forensic log: " + e.getMessage();
+        }
+
+        if (lastLine == null) return "Forensic log is empty: " + file.getAbsolutePath();
+        try {
+            JSONObject obj = new JSONObject(lastLine);
+            return "file=" + file.getName()
+                    + ", event=" + obj.optString("event_id", "?")
+                    + ", trace=" + obj.optString("trace_id", "")
+                    + ", stage=" + obj.optString("stage", "")
+                    + ", msg=" + obj.optString("message", "");
+        }
+        catch (JSONException e) {
+            return "Latest forensic line is not JSON (" + file.getName() + "): " + lastLine;
+        }
+    }
+
+    public static JSONObject snapshotFields(JSONObject base, String prefix, JSONObject source) {
+        JSONObject out = base != null ? base : new JSONObject();
+        if (source == null) return out;
+        JSONArray names = source.names();
+        if (names == null) return out;
+        for (int i = 0; i < names.length(); i++) {
+            String key = names.optString(i, "");
+            if (key.isEmpty()) continue;
+            try {
+                out.put(prefix + key, source.opt(key));
+            }
+            catch (JSONException ignored) {}
+        }
+        return out;
+    }
+
+    private static void logcat(String severity, String line) {
+        switch (severity == null ? "info" : severity.toLowerCase(Locale.US)) {
+            case "warn":
+                Log.w(TAG, line);
+                break;
+            case "error":
+                Log.e(TAG, line);
+                break;
+            default:
+                Log.i(TAG, line);
+                break;
+        }
+    }
+
+    private static String sanitize(String value) {
+        return value == null ? "" : value;
+    }
+}
diff --git a/app/src/main/res/layout/content_list_item.xml b/app/src/main/res/layout/content_list_item.xml
index 0266ba9..03dff69 100644
--- a/app/src/main/res/layout/content_list_item.xml
+++ b/app/src/main/res/layout/content_list_item.xml
@@ -17,31 +17,38 @@
         android:layout_marginBottom="8dp"
         app:tint="@color/colorPrimaryDark" />
 
-    <LinearLayout
-        android:layout_width="0dp"
-        android:layout_weight="1"
-        android:layout_height="match_parent"
-        android:layout_gravity="center"
-        android:orientation="vertical">
-
-        <TextView
-            android:id="@+id/TVVersionName"
-            android:layout_width="match_parent"
-            android:layout_height="0dp"
-            android:layout_weight="1"
-            android:layout_gravity="center"
-            android:gravity="start|center"
-            android:maxLines="1" />
-
-        <TextView
-            android:id="@+id/TVVersionCode"
-            android:layout_width="match_parent"
-            android:layout_height="0dp"
-            android:layout_weight="1"
-            android:layout_gravity="center"
-            android:gravity="start|center"
-            android:maxLines="1" />
-    </LinearLayout>
+    <LinearLayout
+        android:layout_width="0dp"
+        android:layout_weight="1"
+        android:layout_height="wrap_content"
+        android:layout_gravity="center"
+        android:orientation="vertical">
+
+        <TextView
+            android:id="@+id/TVVersionName"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_gravity="center"
+            android:gravity="start|center"
+            android:maxLines="1" />
+
+        <TextView
+            android:id="@+id/TVVersionCode"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_gravity="center"
+            android:gravity="start|center"
+            android:maxLines="1" />
+
+        <TextView
+            android:id="@+id/TVSource"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:alpha="0.85"
+            android:maxLines="1"
+            android:textSize="12sp"
+            android:visibility="gone" />
+    </LinearLayout>
 
     <ImageButton
         android:id="@+id/BTMenu"
diff --git a/app/src/main/res/layout/diagnostics_fragment.xml b/app/src/main/res/layout/diagnostics_fragment.xml
new file mode 100644
index 0000000..2497e1b
--- /dev/null
+++ b/app/src/main/res/layout/diagnostics_fragment.xml
@@ -0,0 +1,61 @@
+<?xml version="1.0" encoding="utf-8"?>
+<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent"
+    android:fillViewport="true">
+
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:orientation="vertical"
+        android:padding="16dp">
+
+        <TextView
+            android:id="@+id/TVHint"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:text="@string/diagnostics_hint"
+            android:textSize="14sp" />
+
+        <EditText
+            android:id="@+id/ETContainerId"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="12dp"
+            android:hint="@string/diagnostics_container_id_hint"
+            android:inputType="number"
+            android:maxLines="1" />
+
+        <Button
+            android:id="@+id/BTRunDirectXServer"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="12dp"
+            android:text="@string/diagnostics_run_direct_xserver" />
+
+        <Button
+            android:id="@+id/BTValidateContainersParser"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="8dp"
+            android:text="@string/diagnostics_validate_parser" />
+
+        <Button
+            android:id="@+id/BTShowLastForensicTrace"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="8dp"
+            android:text="@string/diagnostics_show_last_trace" />
+
+        <TextView
+            android:id="@+id/TVResult"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="16dp"
+            android:background="#12000000"
+            android:padding="12dp"
+            android:text="@string/diagnostics_waiting"
+            android:textIsSelectable="true"
+            android:textSize="13sp" />
+    </LinearLayout>
+</ScrollView>
diff --git a/app/src/main/res/menu/main_menu.xml b/app/src/main/res/menu/main_menu.xml
index 59e56ce..fdde3bd 100644
--- a/app/src/main/res/menu/main_menu.xml
+++ b/app/src/main/res/menu/main_menu.xml
@@ -5,9 +5,10 @@
         <item android:icon="@drawable/icon_shortcut" android:id="@+id/main_menu_shortcuts" android:title="@string/shortcuts" />
         <item android:icon="@drawable/icon_container" android:id="@+id/main_menu_containers" android:title="@string/containers" />
         <item android:icon="@drawable/icon_input_controls" android:id="@+id/main_menu_input_controls" android:title="@string/input_controls" />
-        <item android:icon="@drawable/icon_open" android:id="@+id/main_menu_contents" android:title="@string/contents"/>
-        <item android:icon="@drawable/icon_open" android:id="@+id/main_menu_adrenotools_gpu_drivers" android:title="@string/adrenotools_gpu_drivers"/>
-        <item android:icon="@drawable/icon_settings" android:id="@+id/main_menu_settings" android:title="@string/settings" />
-        <item android:icon="@drawable/icon_about" android:id="@+id/main_menu_about" android:title="@string/about" />
-    </group>
-</menu>
\ No newline at end of file
+        <item android:icon="@drawable/icon_open" android:id="@+id/main_menu_contents" android:title="@string/contents"/>
+        <item android:icon="@drawable/icon_open" android:id="@+id/main_menu_adrenotools_gpu_drivers" android:title="@string/adrenotools_gpu_drivers"/>
+        <item android:icon="@drawable/icon_debug" android:id="@+id/main_menu_diagnostics" android:title="@string/diagnostics" />
+        <item android:icon="@drawable/icon_settings" android:id="@+id/main_menu_settings" android:title="@string/settings" />
+        <item android:icon="@drawable/icon_about" android:id="@+id/main_menu_about" android:title="@string/about" />
+    </group>
+</menu>
-- 
2.43.0

